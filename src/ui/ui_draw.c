/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ui_draw.c                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: bewong <bewong@student.codam.nl>           +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/08/13 15:27:28 by bewong            #+#    #+#             */
/*   Updated: 2025/08/13 15:27:28 by bewong           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "ui.h"

const uint8_t	g_font[256][8] = {
[0 ...31] = {0},
[' '] = {0},
['%'] = {0x21, 0x52, 0x24, 0x08, 0x10, 0x24, 0x4A, 0x84},
['.'] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18},
['-'] = {0x00, 0x00, 0x00, 0x7E, 0x7E, 0x00, 0x00, 0x00},
['+'] = {0x00, 0x18, 0x18, 0x7E, 0x7E, 0x18, 0x18, 0x00},
['0'] = {0x3C, 0x42, 0x46, 0x4A, 0x52, 0x62, 0x42, 0x3C},
['1'] = {0x10, 0x30, 0x50, 0x10, 0x10, 0x10, 0x10, 0x7C},
['2'] = {0x3C, 0x42, 0x02, 0x0C, 0x30, 0x40, 0x40, 0x7E},
['3'] = {0x3C, 0x42, 0x02, 0x1C, 0x02, 0x02, 0x42, 0x3C},
['4'] = {0x04, 0x0C, 0x14, 0x24, 0x44, 0x7E, 0x04, 0x04},
['5'] = {0x7E, 0x40, 0x40, 0x7C, 0x02, 0x02, 0x42, 0x3C},
['6'] = {0x1C, 0x20, 0x40, 0x7C, 0x42, 0x42, 0x42, 0x3C},
['7'] = {0x7E, 0x02, 0x04, 0x08, 0x10, 0x20, 0x20, 0x20},
['8'] = {0x3C, 0x42, 0x42, 0x3C, 0x42, 0x42, 0x42, 0x3C},
['9'] = {0x3C, 0x42, 0x42, 0x3E, 0x02, 0x04, 0x08, 0x30},
['A'] = {0x18, 0x24, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42},
['B'] = {0x7C, 0x42, 0x42, 0x7C, 0x42, 0x42, 0x42, 0x7C},
['C'] = {0x3C, 0x42, 0x40, 0x40, 0x40, 0x40, 0x42, 0x3C},
['D'] = {0x78, 0x44, 0x42, 0x42, 0x42, 0x42, 0x44, 0x78},
['E'] = {0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x7E},
['F'] = {0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x40},
['G'] = {0x3C, 0x42, 0x40, 0x4E, 0x42, 0x42, 0x42, 0x3C},
['H'] = {0x42, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x42},
['I'] = {0x7C, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x7C},
['J'] = {0x3E, 0x08, 0x08, 0x08, 0x08, 0x08, 0x48, 0x30},
['K'] = {0x42, 0x44, 0x48, 0x70, 0x48, 0x44, 0x42, 0x42},
['L'] = {0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7E},
['M'] = {0x42, 0x66, 0x5A, 0x5A, 0x42, 0x42, 0x42, 0x42},
['N'] = {0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x42, 0x42},
['O'] = {0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C},
['P'] = {0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x40},
['Q'] = {0x3C, 0x42, 0x42, 0x42, 0x4A, 0x44, 0x3A, 0x00},
['R'] = {0x7C, 0x42, 0x42, 0x7C, 0x48, 0x44, 0x42, 0x42},
['S'] = {0x3C, 0x42, 0x40, 0x3C, 0x02, 0x02, 0x42, 0x3C},
['T'] = {0xFE, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10},
['U'] = {0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C},
['V'] = {0x42, 0x42, 0x42, 0x24, 0x24, 0x24, 0x18, 0x18},
['W'] = {0x42, 0x42, 0x42, 0x5A, 0x5A, 0x66, 0x42, 0x42},
['X'] = {0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42},
['Y'] = {0x82, 0x44, 0x28, 0x10, 0x10, 0x10, 0x10, 0x10},
['Z'] = {0x7E, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7E},
};

static void	draw_char(mlx_image_t *canvas, char c, t_v2f pos, uint32_t color)
{
	unsigned char	uc;
	t_v2f			d;

	uc = (unsigned char)c;
	if ((uc < 32 && uc != ' ') || (uc >= 128 || (uc > 0 && ft_memcmp(g_font[uc],
					(uint8_t[8]){0}, 8) == 0 && uc != ' ')))
		return ;
	d.y = -1;
	while (++d.y < 8)
	{
		d.x = -1;
		while (++d.x < 8)
		{
			if (g_font[uc][(int)d.y] & (1 << (7 - (int)d.x)))
			{
				if (pos.x + d.x >= 0 && pos.y + d.y >= 0
					&& pos.x + d.x < (int)canvas->width
					&& pos.y + d.y < (int)canvas->height)
					mlx_put_pixel(canvas, pos.x + d.x, pos.y + d.y, color);
			}
		}
	}
}

void	draw_text(mlx_image_t *canvas, const char *str,
			t_v2f pos, uint32_t color)
{
	size_t	i;

	i = 0;
	if (pos.y < 0 || pos.y + 8 > (int)canvas->height)
		return ;
	while (str[i])
	{
		if (pos.x + 8 > (int)canvas->width)
		{
			pos.x = (int)pos.x;
			pos.y += 10;
			if (pos.y + 8 > (int)canvas->height)
				break ;
		}
		draw_char(canvas, str[i], pos, color);
		pos.x += UI_CHAR_WIDTH;
		i++;
	}
}

void	draw_rect_border(mlx_image_t *canvas, t_v2f pos,
				t_v2f size, uint32_t color)
{
	t_v2f		p;
	t_v2f		end;

	end.x = pos.x + size.x;
	end.y = pos.y + size.y;
	p.y = pos.y - 1;
	while (++p.y < end.y)
	{
		p.x = pos.x - 1;
		while (++p.x < end.x)
		{
			if ((p.x == pos.x || p.x == end.x - 1
					|| p.y == pos.y || p.y == end.y - 1)
				&& p.x >= 0 && p.y >= 0 && p.x < canvas->width
				&& p.y < canvas->height)
				mlx_put_pixel(canvas, p.x, p.y, color);
		}
	}
}

void	draw_rect(mlx_image_t *canvas, t_v2f pos, t_v2f size, uint32_t color)
{
	t_v2f		_pos;
	t_v2f		start;
	t_v2f		end;
	uint32_t	alpha;

	alpha = (color & 0xFF);
	start = init_v2f(fmax(0, pos.x), fmax(0, pos.y));
	end = init_v2f(fmin(canvas->width - 1, pos.x + size.x - 1),
			fmin(canvas->height - 1, pos.y + size.y - 1));
	_pos.x = start.x - 1;
	while (++_pos.x <= end.x)
	{
		_pos.y = start.y - 1;
		while (++_pos.y <= end.y)
		{
			if (alpha == 255)
				mlx_put_pixel(canvas, _pos.x, _pos.y, color);
			else
				mlx_put_pixel(canvas, _pos.x, _pos.y,
					blend_colors(rt_get_pixel(canvas, _pos.x, _pos.y), color));
		}
	}
}

void	draw_button(t_ui_element *button, t_ui_context *ctx)
{
	t_ui_btn	*btn_data;
	t_v2f		text_pos;
	int			text_width;

	draw_rect(ctx->canvas, button->abs_pos, button->size, UI_BUTTON_COLOR);
	draw_rect_border(ctx->canvas, button->abs_pos,
		button->size, UI_BUTTON_BORDER_COLOR);
	btn_data = (t_ui_btn *)button->data;
	if (btn_data && btn_data->label)
	{
		text_width = ft_strlen(btn_data->label) * UI_CHAR_WIDTH;
		text_pos.x = button->abs_pos.x + (button->size.x - text_width) / 2;
		text_pos.y = button->abs_pos.y
			+ (button->size.y - UI_CHAR_HEIGHT) / 1.5;
		draw_text(ctx->canvas, btn_data->label, text_pos, UI_TEXT_COLOR);
	}
}
